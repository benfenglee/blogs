# 浏览器的渲染流程
## 1.解析HTML
- 构建DOM树:从服务器获取到HTML文档后,开始解析HTML代码,将其转换为DOM树,DOM树是HTML文档的树状结构表示,每一个HTML都对应一个DOM节点.
- 遇到外部资源:在解析HTML时如果遇到`<link>`,`<sript>`,`<img>`等标签,浏览器会发起网络请求加载外部资源(如CSS文件,JavaScript文件,图片文件等等).
## 2.解析CSS
- 构建CSSOM树:浏览器解析CSS文件或内联样式,生成CSSOM树,CSS树表示CSS样式的层级结构,包含选择器和对应的样式规则.
## 3.构建渲染树
- 合并DOM和CSSOM:将DOM树和CSSOM树结合生成渲染树.渲染树只含需要显示的节点(`display:none`的元素不会出现在渲染树中).
- 计算布局:根据渲染树,浏览器计算每个节点的位置\大小等信息,这个过程称为布局\重排
## 4.绘制
- 生成绘制指令:浏览器根据渲染树的布局信息,将每个节点转换为屏幕上的实际像素点,生成绘制指令.
- 栅格化:将绘制指令转为位图,这个过程通常时浏览器的渲染引擎来完成的.
## 5.合成
- 合成与分层:现代浏览器会将页面分为多个图层,每个图层可以独立绘制和更新,最后浏览器将	这些图层合并成最终的页面图像并显示在屏幕上.
- GPU加速:合成过程通常由GPU加速,以提高性能.
## 6.交互与更新
- 在解析HTML时遇到script标签,浏览器会暂停HTML的解析,下载并执行其中的JavaScript代码,JavaScript可能会修改DOM或CSSOM,导致重新布局与绘制.
- 重绘与重排:当页面发生改变时可能会触发重绘与重排.
	- 重排:当页面元素的几何信息发生了改变时会触发重排:
		- 触发重排的操作:
			- 改变元素的大小
			- 改变元素的位置
			- 改变元素的显示类型(display:none\display:block).
			- 改变文档结构如删除\添加等操作
			- 改变元素的字体
		- 影响范围:
			- 重排会影响到当前元素以及他的后代元素,重排不仅会导致这些元素重新计算,还会引起整个页面的布局重新计算
		- 性能影响:
			- 每次重排都有可能需要浏览器重新计算页面的几何信息(位置\大小)并重建渲染树,导致页面性能下降,尤其是复杂的布局和高频率的DOM操作时.
	- 重绘:一些元素的样式样式发生了改变,但是不触及几何信息的.
		- 触发重绘的操作:
			- 改变元素的颜色
			- 改变元素的可见性
			- 改变元素的透明度
			- 改变元素的阴影
		- 影响范围:
			-	重绘只会影响到样式被改变的元素,不会影响到其他元素的布局.
		- 性能影响:
			- 重绘的成本相对较低,因为他不会重新计算布局,只是渲染元素的外观效果.如果频繁的发生重绘尤其是大面积的元素,仍然会造成性能损失.
